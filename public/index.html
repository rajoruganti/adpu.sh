<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>index</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Raj Oruganti">
	<!-- Date: 2013-06-01 -->
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
    <style>
        body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script src="http://use.edgefonts.net/andika.js"></script>
    <script src="http://use.edgefonts.net/arvo.js"></script>

</head>
<body>
		<div class="container-fluid home-hero">
			
		            <h3>pro.mo</h3>

		    <br/>
		    <div style="opacity: .9;">
				<div>
				<form id="qform" method="post" class="form-search">
					<div>
			   	<label for="message">Message that you want to spread<label>
					<textarea id="message" name="message"></textarea>
					</div>
					<div>
					<label for="reward">Reward URL</label>
					<input type="text" id="reward" name="reward"/>
					</div>
					<div>
						<label for="sites">Where do you want to spread your message?</label>
						<input type="checkbox" name="sites" value="twitter" />Twitter<br />
						<input type="checkbox" name="sites" value="facebook" />Facebook<br />

					</div>
					<div>
						<label for="email">Email</label>
						<input type="text" name="email" id="email"/>
					</div>
					<button type="submit" class="btn">Generate pro.mo link</button>
				</form>
				</div>
				
				
			</div>
	
		</div>
		<div class="row-fluid">
			<div class="span6 offset3">
				<div id="results">
					<div data-bind="template: { foreach: plinks }">
						<div>
							<div id="column1-wrap" >
								<a data-bind="attr: { href: plink}">
								    your pro.mo
								</a>
							</div>
							<div id="clear"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	


	<script src="lib/jquery-1.8.2.min.js"></script>
	<script src="lib/knockout-2.2.1.js"></script>
	<script src="lib/bootstrap.min.js"></script>
	<script src="lib/jquery.blockUI.js"></script>
	<script type="text/javascript">
	
		var data = [];   
		
		
		var viewModel = function(){
		    var self=this;
		
			self.content = ko.observable();
			self.content.loading = ko.observable(false);
			self.plinks= ko.observableArray(data);

		/*	self.EditingUser = ko.observable();
			self.EditUser = function(user) {
			        self.EditingUser(user);
					console.log("edit");
					},
			self.SaveUser = function() {
				self.EditingUser(undefined);
					}
				*/
		};
		var app = new viewModel();
		ko.applyBindings(app);

		$(function () {
		    // on this click event, we popular the observable array
		    $("form").submit(function (e) {
				e.preventDefault();
				$("#results").hide();
				$.blockUI({ message: "<i class=\"icon-spinner icon-spin icon-large\"></i> Fetching Content..." });
				console.log(JSON.stringify($(this).serializeArray()));
		        $.ajax({
					type: "POST",
		            url: '/create/',
					data: JSON.stringify($(this).serializeArray()),
					contentType:'application/json',
		            dataType: 'json',
					beforeSend: function(data){
						app.content.loading(true);
						
					},
		            success: function (data) {
						console.log(data.xtext);
						$("#results").show();
						$.unblockUI();
						app.content.loading(false);
						console.log(data);
		                app.plinks(data);
						//$("#column2").innerHTML = data.xtext;
		            }
		        });
		    });
		});
	      (function($){

		  $.fn.serializeJSON = function(){
		    var json = {}
		    var form = $(this);
		    form.find('input, select').each(function(){
		      var val
		      if (!this.name) return;

		      if ('radio' === this.type) {
		        if (json[this.name]) { return; }

		        json[this.name] = this.checked ? this.value : '';
		      } else if ('checkbox' === this.type) {
		        val = json[this.name];

		        if (!this.checked) {
		          if (!val) { json[this.name] = ''; }
		        } else {
		          json[this.name] = 
		            typeof val === 'string' ? [val, this.value] :
		            $.isArray(val) ? $.merge(val, [this.value]) :
		            this.value;
		        }
		      } else {
		        json[this.name] = this.value;
		      }
		    })
		    return json;
		  }

		})(jQuery)
	</script>
	
	
	
</body>
</html>
