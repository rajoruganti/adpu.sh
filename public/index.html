<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>index</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Raj Oruganti">
	<!-- Date: 2013-06-01 -->
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
    <style>
        body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script src="http://use.edgefonts.net/andika.js"></script>
    <script src="http://use.edgefonts.net/arvo.js"></script>

</head>
<body>
		<div class="container-fluid home-hero">
			
		            <h3>pro.mo</h3>

		    <br/>
		    <div style="opacity: .9;">
				<div class="offset4 span6 offset4">
				<form id="qform" method="post" class="form-search">
						<fieldset>

						<!-- Form Name -->
						<legend>Create a promo</legend>

						<!-- Textarea -->
						<div class="control-group">
						  <label class="control-label">What message do you want to promote?</label>
						  <div class="controls">                     
							<textarea id="message" name="message" maxlength="140" rows="2" placeholder="try to stick to 140 chars."></textarea>
						  </div>
						</div>

						<!-- Text input-->
						<div class="control-group">
						  <label class="control-label">Reward URL</label>
						  <div class="controls">
						    <input id="reward" name="reward" type="text" placeholder="http://google.com" class="input-xlarge" required="">
						    <p class="help-block">What will your site visitors get in return for posting your message on Social Media networks</p>
						  </div>
						</div>

						<!-- Multiple Checkboxes -->
						<div class="control-group">
						  <label class="control-label">Where do you want to promote your message?</label>
						  <div class="controls">
						    <label class="checkbox">
						      <input type="checkbox" name="sites" value="twitter">
						      Twitter
						    </label>
						    <label class="checkbox">
						      <input type="checkbox" name="sites" value="facebook">
						      Facebook
						    </label>
						  </div>
						</div>

						<!-- Text input-->
						<div class="control-group">
						  <label class="control-label">Email</label>
						  <div class="controls">
						    <input id="email" name="email" type="text" placeholder="doc@example.com" class="input-xlarge" required="">
						    <p class="help-block">Track your campaigns</p>
						  </div>
						</div>

						<!-- Text input-->
						<div class="control-group">
						  <label class="control-label">Campaign Name</label>
						  <div class="controls">
						    <input id="campaign" name="campaign" type="text" placeholder="The promotion" class="input-xlarge">
						    <p class="help-block">Give your campaign a friendly name so you can track it easily later</p>
						  </div>
						</div>

						</fieldset>
					<button type="submit" class="btn">Generate pro.mo link</button>
				</form>
				<form class="form-horizontal">
			
				</form>
				
				</div>
				
				
			</div>
	
		</div>
		<div class="row-fluid">
			<div class="span6 offset3">
				<div id="results">
					<div data-bind="template: { foreach: plinks }">
						<div>
							<div id="column1-wrap" >
								<a data-bind="attr: { href: plink}">
								    your pro.mo
								</a>
							</div>
							<div id="clear"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	


	<script src="lib/jquery-1.8.2.min.js"></script>
	<script src="lib/knockout-2.2.1.js"></script>
	<script src="lib/bootstrap.min.js"></script>
	<script src="lib/jquery.blockUI.js"></script>
	<script src="lib/bootstrap.min.js"></script>
	<script src="lib/bootstrap-maxlength.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			console.log("a");
			$('#message').maxlength({
			    alwaysShow: true,
				placement:"right"
			});
		});
		var data = [];   
		
		
		var viewModel = function(){
		    var self=this;
		
			self.content = ko.observable();
			self.content.loading = ko.observable(false);
			self.plinks= ko.observableArray(data);

		/*	self.EditingUser = ko.observable();
			self.EditUser = function(user) {
			        self.EditingUser(user);
					console.log("edit");
					},
			self.SaveUser = function() {
				self.EditingUser(undefined);
					}
				*/
		};
		var app = new viewModel();
		ko.applyBindings(app);
		
		$(function () {
			
		    // on this click event, we popular the observable array
		    $("form").submit(function (e) {
				e.preventDefault();
				$("#results").hide();
				$.blockUI({ message: "<i class=\"icon-spinner icon-spin icon-large\"></i> Fetching Content..." });
				console.log(JSON.stringify($(this).serializeArray()));
		        $.ajax({
					type: "POST",
		            url: '/create/',
					data: JSON.stringify($(this).serializeArray()),
					contentType:'application/json',
		            dataType: 'json',
					beforeSend: function(data){
						app.content.loading(true);
						
					},
		            success: function (data) {
						console.log(data.xtext);
						$("#results").show();
						$.unblockUI();
						app.content.loading(false);
						console.log(data);
		                app.plinks(data);
						//$("#column2").innerHTML = data.xtext;
		            }
		        });
		    });
		});
	      (function($){

		  $.fn.serializeJSON = function(){
		    var json = {}
		    var form = $(this);
		    form.find('input, select').each(function(){
		      var val
		      if (!this.name) return;

		      if ('radio' === this.type) {
		        if (json[this.name]) { return; }

		        json[this.name] = this.checked ? this.value : '';
		      } else if ('checkbox' === this.type) {
		        val = json[this.name];

		        if (!this.checked) {
		          if (!val) { json[this.name] = ''; }
		        } else {
		          json[this.name] = 
		            typeof val === 'string' ? [val, this.value] :
		            $.isArray(val) ? $.merge(val, [this.value]) :
		            this.value;
		        }
		      } else {
		        json[this.name] = this.value;
		      }
		    })
		    return json;
		  }

		})(jQuery)
	</script>
	
	
	
</body>
</html>
