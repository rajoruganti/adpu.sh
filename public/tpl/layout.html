<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{% block title %}Promo{% endblock %}</title>

  {% block head %}
  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>index</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Raj Oruganti">
	<!-- Date: 2013-06-01 -->
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
	<link href="//netdna.bootstrapcdn.com/font-awesome/3.1.1/css/font-awesome.css" rel="stylesheet">
    <style>
        body {
            padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
        }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script src="http://use.edgefonts.net/andika.js"></script>
    <script src="http://use.edgefonts.net/arvo.js"></script>
  {% endblock %}
	{% block extrahead%}
	{% endblock %}
</head>
<body>
	{% block header %} 
		<div class="header">
			<div class="navbar navbar-inverse navbar-fixed-top" style="z-index: 10;">
			    <div class="navbar-inner">
			        <div class="container">
			            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			                <span class="icon-bar"></span>
			                <span class="icon-bar"></span>
			                <span class="icon-bar"></span>
			            </a>
			            <a class="brand" href="/">infex</a>
						

			            <div class="nav-collapse collapse">



			                <ul class="nav pull-right">
			                    <li class="about-menu"><a href="#about" data-toggle="modal">About</a></li>
			                    <li>
									<a href= "#howItWorks"  role="button" data-toggle="modal">How it works</a>

								</li>
								<!--li>
								{%if user%}
								<a href="/account">{{user}}</a>
								{%else%}
								<a href="/auth/twitter"><img src="../css/img/sign-in-with-twitter-gray.png"/></a>  
								{%endif%}
								</li-->
								<li class="dropdown">
									{%if user%}
										<div class="btn-group">
										  <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
										    {{user}}
										    <span class="caret"></span>
										  </a>
										  <ul class="dropdown-menu">
												<li><a href="/dashboard">Campaigns</a></li>
												<li><a href="/profile">Profile</a></li>
												<li><a href="/logout">Signout</a></li>
										  </ul>
										</div>

									{%else%}
								            <a class="dropdown-toggle" href="#" data-toggle="dropdown">Sign In <strong class="caret"></strong></a>
								            <div id="auth" class="dropdown-menu" style="padding: 15px; padding-bottom: 0px;">
												<form method="post" accept-charset="UTF-8" id="signinHome" class="signin">
												  <input id="username" style="margin-bottom: 15px;" type="text" name="username" placeholder="email" size="30" />
												  <input id="password" style="margin-bottom: 15px;" type="password" name="password" placeholder="password" size="30" />
												  <input id="remember_me" style="float: left; margin-right: 10px;" type="checkbox" name="user[remember_me]" value="1" />
												  <label class="string optional" for="user_remember_me"> Remember me</label>

												  <input class="btn btn-primary" style="clear: left; width: 100%; height: 32px; font-size: 13px;" type="submit" name="commit" value="Sign In" />
													<div data-bind="template: { foreach: authResponses }">
												<span data-bind="{'text':message}"></span>
												
												</div>

												</form>
								            </div>
								{%endif%}
								          </li>

			                </ul>
			            </div>
			            <!--/.nav-collapse -->
			        </div>
			    </div>
			</div>
			<!-- How Modal -->
			<div id="howItWorks" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="howItWorksLabel" aria-hidden="true">
			  <div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			    <h3 id="myModalLabel">How it works</h3>
			  </div>
			  <div class="modal-body">
			    <p>
			    	<ul>
			    		<li>
			    			Generate a promotion link
			    		</li>
						Use the link on your web properties
						reward your visitors
						track submissions and updates

			    	</ul>
			    </p>
			  </div>
			  <div class="modal-footer">
			    <button class="btn" data-dismiss="modal" aria-hidden="true">OK. Got it.</button>
			  </div>
			</div>
			<!-- About Modal -->
			<div id="about" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="howItWorksLabel" aria-hidden="true">
			  <div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			    <h3 id="myModalLabel">About</h3>
			  </div>
			  <div class="modal-body">
			    <p>
			    	Work less. Crowd-source your SM campaigns.
				</p>
			  </div>

			</div>
		</div>
	
	{% endblock %} <!-- end header-->
	
		<div class="container-fluid home-hero">
			<p id="out"></p>
		          
		    <div>
	
	{% block content %}
	
	{% endblock %}
	</div>
	</div>
	<script src="lib/jquery-1.8.2.min.js"></script>
	<script src="lib/knockout-2.2.1.js"></script>
	<script src="lib/bootstrap.min.js"></script>
	<script src="lib/jquery.blockUI.js"></script>
	<script src="lib/bootstrap-maxlength.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
		//	console.log("a");
			$('#message').maxlength({
			    alwaysShow: true,
				placement:"right"
			});
			$('.upcoming').popover({ 
				placement:"bottom",
			    html : true,
			    content: function() {
			      return $('#upcoming_popover_content_wrapper').html();
			    }
			  });
			$("#showPromoForm").live('click', function () {
				$('#qform')[0].reset();
				$("#promoForm").show('slow');
				$("#results").hide('slow');
			});
			//sign-in form
			// Setup drop down menu
			  $('.dropdown-toggle').dropdown();

			  // Fix input element click problem
			  $('.dropdown input, .dropdown label').click(function(e) {
			    e.stopPropagation();
			  });
		});	

		
			//let KO know that we will take care of managing the bindings of our children
			ko.bindingHandlers.stopBinding = {
			    init: function() {
			        return { controlsDescendantBindings: true };
			    }        
			};

			//KO 2.1, now allows you to add containerless support for custom bindings
			ko.virtualElements.allowedBindings.stopBinding = true;

			var data = [];   

			var AuthviewModel = {

				authResponses : ko.observableArray(data)

			};
			var PlinkviewModel = {

				plinks: ko.observableArray(data)
			};
	
		

				ko.applyBindings(AuthviewModel);
				ko.applyBindings(PlinkviewModel, document.getElementById("results"))
		
			// sign-in
	$(function (){
		
				$(".signin").live('submit', function(e){
						e.preventDefault();
						$.blockUI({ message: "<i class=\"icon-spinner icon-spin icon-large\"></i> Signing in..." });
						var username = $(this).find('input[name="username"]').val()
						var password = $(this).find('input[name="password"]').val()
				        $.ajax({
							type: "POST",
				            url: '/login/',
							data: {'username':username, 'password':password},
							beforeSend: function(data){
							},
							error: function(data){
								console.log(data);
							},
				            success: function (data) {
								$.unblockUI();
								console.log(data);
				                AuthviewModel.authResponses(data);
								if (data.status == "ok"){
									window.location = "/";
								}
				            }
				        });
				});
			});

		$(function () {
		    // on this click event, we popular the observable array
		    $("#qform").submit(function (e) {
				e.preventDefault();
				$("#results").hide();
				$.blockUI({ message: "<i class=\"icon-spinner icon-spin icon-large\"></i> Fetching Content..." });
				console.log(JSON.stringify($(this).serializeArray()));
		        $.ajax({
					type: "POST",
		            url: '/create/',
					data: JSON.stringify($(this).serializeArray()),
					contentType:'application/json',
		            dataType: 'json',
					beforeSend: function(data){
						
					},
		            success: function (data) {
						console.log(data.xtext);
						$("#results").show('slow');
						$("#promoForm").hide('slow');
						$.unblockUI();
						//app.content.loading(false);
						console.log(data);
		                //aapp.plinks(data);
						//var parsed = JSON.parse(data);
						//var parsed = jQuery.parseJSON(data);
						PlinkviewModel.plinks(data)
						//$("#column2").innerHTML = data.xtext;
		            }
		        });
		    });
		});
	      
	</script>
	
	
	
	{% block footer %} 
	{% endblock %}
</body>
</html>